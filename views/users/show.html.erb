<% provide(:title, @user.name) %>

<div class="container py-4">

  <% if notice.present? %>
    <div class="alert alert-success text-center mb-4">
      <%= notice %>
    </div>
  <% end %>

  <!-- Profile Card -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-4">
      <div class="d-flex flex-column flex-md-row align-items-center gap-4">
        <!-- Avatar -->
        <div class="text-center">
          <%= gravatar_for @user, size: 160, class: "rounded-circle border" %>
        </div>  

        <section class="stats">
          <%= render 'shared/stats' %>
        </section>

        <!-- Main info -->
        <div class="flex-fill w-100">
          <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
            <div>
              <h1 class="h2 mb-1 fw-bold"><%= @user.name %></h1>
              <div class="text-muted">
                <i class="bi bi-envelope"></i>
                <%= mail_to @user.email, @user.email %>
              </div>
            </div>

            <!-- Actions -->
            <div class="d-flex flex-wrap gap-2">
              <%= link_to edit_user_path(@user), class: "btn btn-outline-primary" do %>
                <i class="bi bi-pencil-square"></i> Edit
              <% end %>

              <%= link_to users_path, class: "btn btn-outline-secondary" do %>
                <i class="bi bi-people"></i> Back to Users
              <% end %>

              <!-- Trigger delete confirmation modal -->
              <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteUserModal">
                <i class="bi bi-trash"></i> Delete
              </button>
            </div>
          </div>

          <!-- Meta / Greeting -->
          <div class="mt-3 p-3 bg-light rounded">
            <span class="text-muted">Welcome,</span>
            <strong><%= @user.name %></strong> â€” your registered email is
            <strong><%= @user.email %></strong>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- (Optional) extra sections -->
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Account Details</h5>
          <ul class="list-unstyled mb-0">
            <li class="mb-2"><i class="bi bi-person"></i> Name: <strong><%= @user.name %></strong></li>
            <li class="mb-2"><i class="bi bi-envelope-open"></i> Email: <strong><%= @user.email %></strong></li>
            <!-- add more fields here if you have them -->
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">Quick Actions</h5>
          <div class="d-flex flex-wrap gap-2">
            <%= link_to edit_user_path(@user), class: "btn btn-primary" do %>
              <i class="bi bi-gear"></i> Manage Profile
            <% end %>
            <%= link_to users_path, class: "btn btn-secondary" do %>
              <i class="bi bi-list-ul"></i> View All Users
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Delete confirmation modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteUserModalLabel">Delete user?</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        This action cannot be undone. Are you sure you want to delete <strong><%= @user.name %></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <%= button_to @user, method: :delete,
              form: { data: { turbo_confirm: "This will permanently delete the user. Proceed?" } },
              class: "btn btn-danger" do %>
          <i class="bi bi-trash"></i> Yes, delete
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="col-md-8">
  <%= render 'follow_form' if logged_in? %>
  <% if @user.microposts.any? %>
    <h3>Microposts (<%= @user.microposts.count %>)</h3>
    <ol class="microposts">
      <%= render @microposts %>
    </ol>
      <%= will_paginate @microposts %>
    <% end %>
  </div>
</div>
